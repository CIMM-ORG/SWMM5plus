<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Prototype Fortran 2008 engine for the EPA Storm Water Management Model (SWMM)">
    
    <meta name="author" content="Ben R. Hodges and Ehsan Madadi-Kandjani" >
    <link rel="icon" href="../favicon.png">

    <title>adjustments.f08 &ndash; SWMMengine</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SWMMengine </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>adjustments.f08
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 6.0% of total for source files.">447 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/adjustments.f08"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">adjustments.f08</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/adjustments.html">adjustments</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/adjustments.f08.html#src">adjustments.f08</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~adjustments.f08~~EfferentGraph Pages: 1 -->
<svg id="sourcefileadjustmentsf08EfferentGraph" width="641pt" height="167pt"
 viewBox="0.00 0.00 641.00 167.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~adjustments.f08~~EfferentGraph" class="graph" transform="scale(0.918338 0.918338) rotate(0) translate(4 178.373)">
<title>sourcefile~~adjustments.f08~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-178.373 694,-178.373 694,4 -4,4"/>
<!-- sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node1" class="node"><title>sourcefile~adjustments.f08</title>
<polygon fill="none" stroke="black" points="690,-99.1865 602,-99.1865 602,-75.1865 690,-75.1865 690,-99.1865"/>
<text text-anchor="middle" x="646" y="-84.7865" font-family="Helvetica,sans-Serif" font-size="10.50">adjustments.f08</text>
</g>
<!-- sourcefile~utility.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node2" class="node"><title>sourcefile~utility.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node2"><a xlink:href=".././sourcefile/utility.f08.html" xlink:title="utility.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="566,-99.1865 511,-99.1865 511,-75.1865 566,-75.1865 566,-99.1865"/>
<text text-anchor="middle" x="538.5" y="-84.7865" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">utility.f08</text>
</a>
</g>
</g>
<!-- sourcefile~adjustments.f08&#45;&gt;sourcefile~utility.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge5" class="edge"><title>sourcefile~adjustments.f08&#45;&gt;sourcefile~utility.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M601.785,-87.1865C593.302,-87.1865 584.48,-87.1865 576.234,-87.1865"/>
<polygon fill="#000000" stroke="#000000" points="576.167,-83.6866 566.167,-87.1865 576.167,-90.6866 576.167,-83.6866"/>
</g>
<!-- sourcefile~setting_definition.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node3" class="node"><title>sourcefile~setting_definition.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node3"><a xlink:href=".././sourcefile/setting_definition.f08.html" xlink:title="setting_definition.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="252,-119.186 141,-119.186 141,-95.1865 252,-95.1865 252,-119.186"/>
<text text-anchor="middle" x="196.5" y="-104.786" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setting_definition.f08</text>
</a>
</g>
</g>
<!-- sourcefile~adjustments.f08&#45;&gt;sourcefile~setting_definition.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge2" class="edge"><title>sourcefile~adjustments.f08&#45;&gt;sourcefile~setting_definition.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M537.5,-167.186C472.247,-182.293 451.194,-170.383 388,-148.186 355.062,-136.617 355.773,-110.281 321,-107.186"/>
</g>
<!-- sourcefile~globals.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node4" class="node"><title>sourcefile~globals.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node4"><a xlink:href=".././sourcefile/globals.f08.html" xlink:title="globals.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="352,-79.1865 288,-79.1865 288,-55.1865 352,-55.1865 352,-79.1865"/>
<text text-anchor="middle" x="320" y="-64.7865" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">globals.f08</text>
</a>
</g>
</g>
<!-- sourcefile~adjustments.f08&#45;&gt;sourcefile~globals.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge1" class="edge"><title>sourcefile~adjustments.f08&#45;&gt;sourcefile~globals.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M635.265,-74.997C618.368,-55.0992 581.377,-16.8811 539.5,-7.1865"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M537.5,-7.1865C472.247,7.91965 451.194,-3.98996 388,-26.1865 372.677,-31.5687 357.111,-40.8164 344.844,-49.1683"/>
<polygon fill="#000000" stroke="#000000" points="342.698,-46.3984 336.545,-55.0233 346.734,-52.1181 342.698,-46.3984"/>
</g>
<!-- sourcefile~data_keys.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node5" class="node"><title>sourcefile~data_keys.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node5"><a xlink:href=".././sourcefile/data_keys.f08.html" xlink:title="data_keys.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="471,-139.186 392,-139.186 392,-115.186 471,-115.186 471,-139.186"/>
<text text-anchor="middle" x="431.5" y="-124.786" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">data_keys.f08</text>
</a>
</g>
</g>
<!-- sourcefile~adjustments.f08&#45;&gt;sourcefile~data_keys.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge3" class="edge"><title>sourcefile~adjustments.f08&#45;&gt;sourcefile~data_keys.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M635.265,-99.376C618.368,-119.274 581.377,-157.492 539.5,-167.186"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M537.5,-167.186C523.26,-170.483 489.712,-156.214 464.34,-143.814"/>
<polygon fill="#000000" stroke="#000000" points="465.585,-140.524 455.074,-139.194 462.462,-146.788 465.585,-140.524"/>
</g>
<!-- sourcefile~array_index.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node6" class="node"><title>sourcefile~array_index.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node6"><a xlink:href=".././sourcefile/array_index.f08.html" xlink:title="array_index.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="475,-59.1865 388,-59.1865 388,-35.1865 475,-35.1865 475,-59.1865"/>
<text text-anchor="middle" x="431.5" y="-44.7865" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">array_index.f08</text>
</a>
</g>
</g>
<!-- sourcefile~adjustments.f08&#45;&gt;sourcefile~array_index.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge4" class="edge"><title>sourcefile~adjustments.f08&#45;&gt;sourcefile~array_index.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M537.5,-7.1865C523.26,-3.89001 489.712,-18.1593 464.34,-30.5589"/>
<polygon fill="#000000" stroke="#000000" points="462.462,-27.5847 455.074,-35.1791 465.585,-33.8492 462.462,-27.5847"/>
</g>
<!-- sourcefile~utility.f08&#45;&gt;sourcefile~setting_definition.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge7" class="edge"><title>sourcefile~utility.f08&#45;&gt;sourcefile~setting_definition.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M430.5,-87.1865C381.028,-87.1865 370.277,-111.571 321,-107.186"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M319,-107.186C300.563,-105.546 280.49,-105.03 262.069,-105.061"/>
<polygon fill="#000000" stroke="#000000" points="262.001,-101.561 252.026,-105.13 262.05,-108.561 262.001,-101.561"/>
</g>
<!-- sourcefile~utility.f08&#45;&gt;sourcefile~globals.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge6" class="edge"><title>sourcefile~utility.f08&#45;&gt;sourcefile~globals.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M510.743,-87.1865C489.524,-87.1865 459.115,-87.1865 432.5,-87.1865"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M430.5,-87.1865C407.686,-87.1865 382.627,-82.9333 362.245,-78.3496"/>
<polygon fill="#000000" stroke="#000000" points="362.885,-74.9046 352.349,-76.017 361.279,-81.7179 362.885,-74.9046"/>
</g>
<!-- sourcefile~utility.f08&#45;&gt;sourcefile~data_keys.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge8" class="edge"><title>sourcefile~utility.f08&#45;&gt;sourcefile~data_keys.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M510.732,-97.3837C499.403,-101.7 485.949,-106.825 473.421,-111.598"/>
<polygon fill="#000000" stroke="#000000" points="472.17,-108.329 464.071,-115.159 474.662,-114.87 472.17,-108.329"/>
</g>
<!-- sourcefile~utility.f08&#45;&gt;sourcefile~array_index.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge9" class="edge"><title>sourcefile~utility.f08&#45;&gt;sourcefile~array_index.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M510.732,-76.9893C499.403,-72.6732 485.949,-67.5479 473.421,-62.7753"/>
<polygon fill="#000000" stroke="#000000" points="474.662,-59.503 464.071,-59.2137 472.17,-66.0444 474.662,-59.503"/>
</g>
<!-- sourcefile~type_definitions.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_node7" class="node"><title>sourcefile~type_definitions.f08</title>
<g id="a_sourcefile~~adjustments.f08~~EfferentGraph_node7"><a xlink:href=".././sourcefile/type_definitions.f08.html" xlink:title="type_definitions.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="105,-99.1865 0,-99.1865 0,-75.1865 105,-75.1865 105,-99.1865"/>
<text text-anchor="middle" x="52.5" y="-84.7865" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">type_definitions.f08</text>
</a>
</g>
</g>
<!-- sourcefile~setting_definition.f08&#45;&gt;sourcefile~type_definitions.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge10" class="edge"><title>sourcefile~setting_definition.f08&#45;&gt;sourcefile~type_definitions.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M140.599,-99.454C132.387,-98.2974 123.872,-97.0981 115.525,-95.9225"/>
<polygon fill="#000000" stroke="#000000" points="115.85,-92.4337 105.459,-94.5047 114.873,-99.3653 115.85,-92.4337"/>
</g>
<!-- sourcefile~globals.f08&#45;&gt;sourcefile~setting_definition.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge11" class="edge"><title>sourcefile~globals.f08&#45;&gt;sourcefile~setting_definition.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M287.711,-77.4875C274.457,-81.8509 258.735,-87.0269 244.158,-91.8258"/>
<polygon fill="#000000" stroke="#000000" points="242.698,-88.6216 234.294,-95.0732 244.887,-95.2706 242.698,-88.6216"/>
</g>
<!-- sourcefile~globals.f08&#45;&gt;sourcefile~type_definitions.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge12" class="edge"><title>sourcefile~globals.f08&#45;&gt;sourcefile~type_definitions.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M287.763,-69.5396C245.524,-72.7214 169.275,-78.4652 115.253,-82.5347"/>
<polygon fill="#000000" stroke="#000000" points="114.808,-79.0582 105.099,-83.2995 115.334,-86.0384 114.808,-79.0582"/>
</g>
<!-- sourcefile~data_keys.f08&#45;&gt;sourcefile~globals.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge13" class="edge"><title>sourcefile~data_keys.f08&#45;&gt;sourcefile~globals.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M408.341,-115.045C392.163,-106.18 370.016,-94.0449 352.073,-84.2126"/>
<polygon fill="#000000" stroke="#000000" points="353.578,-81.0463 343.126,-79.3103 350.214,-87.1852 353.578,-81.0463"/>
</g>
<!-- sourcefile~array_index.f08&#45;&gt;sourcefile~globals.f08 -->
<g id="sourcefile~~adjustments.f08~~EfferentGraph_edge14" class="edge"><title>sourcefile~array_index.f08&#45;&gt;sourcefile~globals.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M387.851,-54.9763C379.398,-56.5202 370.54,-58.1381 362.138,-59.6727"/>
<polygon fill="#000000" stroke="#000000" points="361.383,-56.2526 352.175,-61.4925 362.641,-63.1387 361.383,-56.2526"/>
</g>
</g>
</svg>
</div><script>var pansourcefileadjustmentsf08EfferentGraph = svgPanZoom('#sourcefileadjustmentsf08EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,-0 67,-0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,-0 182,-0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~adjustments.f08~~AfferentGraph Pages: 1 -->
<svg id="sourcefileadjustmentsf08AfferentGraph" width="594pt" height="154pt"
 viewBox="0.00 0.00 594.00 154.35" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~adjustments.f08~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 150.347)">
<title>sourcefile~~adjustments.f08~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-150.347 590,-150.347 590,4 -4,4"/>
<!-- sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node1" class="node"><title>sourcefile~adjustments.f08</title>
<polygon fill="none" stroke="black" points="88,-85.1734 0,-85.1734 0,-61.1734 88,-61.1734 88,-85.1734"/>
<text text-anchor="middle" x="44" y="-70.7734" font-family="Helvetica,sans-Serif" font-size="10.50">adjustments.f08</text>
</g>
<!-- sourcefile~runge_kutta.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node2" class="node"><title>sourcefile~runge_kutta.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node2"><a xlink:href=".././sourcefile/runge_kutta.f08.html" xlink:title="runge_kutta.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="375.5,-127.173 287.5,-127.173 287.5,-103.173 375.5,-103.173 375.5,-127.173"/>
<text text-anchor="middle" x="331.5" y="-112.773" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">runge_kutta.f08</text>
</a>
</g>
</g>
<!-- sourcefile~runge_kutta.f08&#45;&gt;sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge1" class="edge"><title>sourcefile~runge_kutta.f08&#45;&gt;sourcefile~adjustments.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M296.923,-127.199C255.185,-140.223 182.333,-156.585 124,-136.173 99.4656,-127.588 76.8667,-107.836 62.1818,-92.7196"/>
<polygon fill="#000000" stroke="#000000" points="64.6449,-90.2293 55.2557,-85.3209 59.5347,-95.0132 64.6449,-90.2293"/>
</g>
<!-- sourcefile~element_geometry.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node3" class="node"><title>sourcefile~element_geometry.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node3"><a xlink:href=".././sourcefile/element_geometry.f08.html" xlink:title="element_geometry.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="244,-85.1734 124,-85.1734 124,-61.1734 244,-61.1734 244,-85.1734"/>
<text text-anchor="middle" x="184" y="-70.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">element_geometry.f08</text>
</a>
</g>
</g>
<!-- sourcefile~runge_kutta.f08&#45;&gt;sourcefile~element_geometry.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge7" class="edge"><title>sourcefile~runge_kutta.f08&#45;&gt;sourcefile~element_geometry.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M288.806,-103.138C272.52,-98.4368 253.678,-92.9979 236.553,-88.0546"/>
<polygon fill="#000000" stroke="#000000" points="237.279,-84.6214 226.701,-85.2107 235.338,-91.3468 237.279,-84.6214"/>
</g>
<!-- sourcefile~element_dynamics.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node4" class="node"><title>sourcefile~element_dynamics.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node4"><a xlink:href=".././sourcefile/element_dynamics.f08.html" xlink:title="element_dynamics.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="244,-127.173 124,-127.173 124,-103.173 244,-103.173 244,-127.173"/>
<text text-anchor="middle" x="184" y="-112.773" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">element_dynamics.f08</text>
</a>
</g>
</g>
<!-- sourcefile~runge_kutta.f08&#45;&gt;sourcefile~element_dynamics.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge10" class="edge"><title>sourcefile~runge_kutta.f08&#45;&gt;sourcefile~element_dynamics.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M287.239,-115.173C276.913,-115.173 265.634,-115.173 254.458,-115.173"/>
<polygon fill="#000000" stroke="#000000" points="254.253,-111.673 244.253,-115.173 254.253,-118.673 254.253,-111.673"/>
</g>
<!-- sourcefile~face_values.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node6" class="node"><title>sourcefile~face_values.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node6"><a xlink:href=".././sourcefile/face_values.f08.html" xlink:title="face_values.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="228,-43.1734 140,-43.1734 140,-19.1734 228,-19.1734 228,-43.1734"/>
<text text-anchor="middle" x="184" y="-28.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">face_values.f08</text>
</a>
</g>
</g>
<!-- sourcefile~runge_kutta.f08&#45;&gt;sourcefile~face_values.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge14" class="edge"><title>sourcefile~runge_kutta.f08&#45;&gt;sourcefile~face_values.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M295.393,-103.107C290.007,-100.551 284.687,-97.577 280,-94.1734 260.107,-79.7262 264.263,-66.0971 244,-52.1734 241.648,-50.557 239.158,-49.0513 236.583,-47.6506"/>
<polygon fill="#000000" stroke="#000000" points="238.102,-44.4978 227.577,-43.2845 235.048,-50.7965 238.102,-44.4978"/>
</g>
<!-- sourcefile~element_geometry.f08&#45;&gt;sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge2" class="edge"><title>sourcefile~element_geometry.f08&#45;&gt;sourcefile~adjustments.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M123.675,-73.1734C115.157,-73.1734 106.439,-73.1734 98.0535,-73.1734"/>
<polygon fill="#000000" stroke="#000000" points="98.0256,-69.6735 88.0256,-73.1734 98.0256,-76.6735 98.0256,-69.6735"/>
</g>
<!-- sourcefile~element_dynamics.f08&#45;&gt;sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge4" class="edge"><title>sourcefile~element_dynamics.f08&#45;&gt;sourcefile~adjustments.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M143.455,-103.138C128.153,-98.4807 110.472,-93.0995 94.3512,-88.1933"/>
<polygon fill="#000000" stroke="#000000" points="95.1369,-84.774 84.551,-85.2107 93.0987,-91.4707 95.1369,-84.774"/>
</g>
<!-- sourcefile~explicit_euler.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node5" class="node"><title>sourcefile~explicit_euler.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node5"><a xlink:href=".././sourcefile/explicit_euler.f08.html" xlink:title="explicit_euler.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="378,-43.1734 285,-43.1734 285,-19.1734 378,-19.1734 378,-43.1734"/>
<text text-anchor="middle" x="331.5" y="-28.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">explicit_euler.f08</text>
</a>
</g>
</g>
<!-- sourcefile~explicit_euler.f08&#45;&gt;sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge3" class="edge"><title>sourcefile~explicit_euler.f08&#45;&gt;sourcefile~adjustments.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M296.923,-19.1483C255.185,-6.1233 182.333,10.2381 124,-10.1734 99.4656,-18.7583 76.8667,-38.5107 62.1818,-53.6272"/>
<polygon fill="#000000" stroke="#000000" points="59.5347,-51.3336 55.2557,-61.0259 64.6449,-56.1175 59.5347,-51.3336"/>
</g>
<!-- sourcefile~explicit_euler.f08&#45;&gt;sourcefile~element_geometry.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge9" class="edge"><title>sourcefile~explicit_euler.f08&#45;&gt;sourcefile~element_geometry.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M288.806,-43.2089C272.52,-47.91 253.678,-53.3489 236.553,-58.2922"/>
<polygon fill="#000000" stroke="#000000" points="235.338,-55 226.701,-61.1361 237.279,-61.7254 235.338,-55"/>
</g>
<!-- sourcefile~explicit_euler.f08&#45;&gt;sourcefile~element_dynamics.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge12" class="edge"><title>sourcefile~explicit_euler.f08&#45;&gt;sourcefile~element_dynamics.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M295.393,-43.2401C290.007,-45.7959 284.687,-48.7698 280,-52.1734 260.107,-66.6206 264.263,-80.2496 244,-94.1734 241.648,-95.7897 239.158,-97.2954 236.583,-98.6961"/>
<polygon fill="#000000" stroke="#000000" points="235.048,-95.5502 227.577,-103.062 238.102,-101.849 235.048,-95.5502"/>
</g>
<!-- sourcefile~explicit_euler.f08&#45;&gt;sourcefile~face_values.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge17" class="edge"><title>sourcefile~explicit_euler.f08&#45;&gt;sourcefile~face_values.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M284.862,-31.1734C270.236,-31.1734 253.903,-31.1734 238.753,-31.1734"/>
<polygon fill="#000000" stroke="#000000" points="238.489,-27.6735 228.488,-31.1734 238.488,-34.6735 238.489,-27.6735"/>
</g>
<!-- sourcefile~face_values.f08&#45;&gt;sourcefile~adjustments.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge5" class="edge"><title>sourcefile~face_values.f08&#45;&gt;sourcefile~adjustments.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M143.455,-43.2089C128.153,-47.866 110.472,-53.2473 94.3512,-58.1534"/>
<polygon fill="#000000" stroke="#000000" points="93.0987,-54.8761 84.551,-61.1361 95.1369,-61.5728 93.0987,-54.8761"/>
</g>
<!-- sourcefile~time_loop.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node7" class="node"><title>sourcefile~time_loop.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node7"><a xlink:href=".././sourcefile/time_loop.f08.html" xlink:title="time_loop.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="496,-43.1734 419,-43.1734 419,-19.1734 496,-19.1734 496,-43.1734"/>
<text text-anchor="middle" x="457.5" y="-28.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">time_loop.f08</text>
</a>
</g>
</g>
<!-- sourcefile~time_loop.f08&#45;&gt;sourcefile~runge_kutta.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge6" class="edge"><title>sourcefile~time_loop.f08&#45;&gt;sourcefile~runge_kutta.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M444.695,-43.3913C430.901,-57.1407 406.908,-79.4708 383,-94.1734 380.414,-95.7635 377.687,-97.284 374.893,-98.7274"/>
<polygon fill="#000000" stroke="#000000" points="373.345,-95.5882 365.839,-103.066 376.37,-101.901 373.345,-95.5882"/>
</g>
<!-- sourcefile~time_loop.f08&#45;&gt;sourcefile~explicit_euler.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge13" class="edge"><title>sourcefile~time_loop.f08&#45;&gt;sourcefile~explicit_euler.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M418.959,-31.1734C409.336,-31.1734 398.777,-31.1734 388.444,-31.1734"/>
<polygon fill="#000000" stroke="#000000" points="388.23,-27.6735 378.23,-31.1734 388.23,-34.6735 388.23,-27.6735"/>
</g>
<!-- sourcefile~time_loop.f08&#45;&gt;sourcefile~face_values.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge16" class="edge"><title>sourcefile~time_loop.f08&#45;&gt;sourcefile~face_values.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M421.785,-19.111C409.67,-15.4775 395.88,-11.9773 383,-10.1734 337.665,-3.82395 325.507,-5.20362 280,-10.1734 266.352,-11.6639 251.793,-14.3249 238.279,-17.2629"/>
<polygon fill="#000000" stroke="#000000" points="237.16,-13.9274 228.18,-19.5488 238.706,-20.7547 237.16,-13.9274"/>
</g>
<!-- sourcefile~initial_condition.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node8" class="node"><title>sourcefile~initial_condition.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node8"><a xlink:href=".././sourcefile/initial_condition.f08.html" xlink:title="initial_condition.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383,-85.1734 280,-85.1734 280,-61.1734 383,-61.1734 383,-85.1734"/>
<text text-anchor="middle" x="331.5" y="-70.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">initial_condition.f08</text>
</a>
</g>
</g>
<!-- sourcefile~initial_condition.f08&#45;&gt;sourcefile~element_geometry.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge8" class="edge"><title>sourcefile~initial_condition.f08&#45;&gt;sourcefile~element_geometry.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M279.611,-73.1734C271.365,-73.1734 262.706,-73.1734 254.114,-73.1734"/>
<polygon fill="#000000" stroke="#000000" points="254.089,-69.6735 244.089,-73.1734 254.089,-76.6735 254.089,-69.6735"/>
</g>
<!-- sourcefile~initial_condition.f08&#45;&gt;sourcefile~element_dynamics.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge11" class="edge"><title>sourcefile~initial_condition.f08&#45;&gt;sourcefile~element_dynamics.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M288.806,-85.2089C272.52,-89.91 253.678,-95.3489 236.553,-100.292"/>
<polygon fill="#000000" stroke="#000000" points="235.338,-97 226.701,-103.136 237.279,-103.725 235.338,-97"/>
</g>
<!-- sourcefile~initial_condition.f08&#45;&gt;sourcefile~face_values.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge15" class="edge"><title>sourcefile~initial_condition.f08&#45;&gt;sourcefile~face_values.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M288.806,-61.1379C272.52,-56.4368 253.678,-50.9979 236.553,-46.0546"/>
<polygon fill="#000000" stroke="#000000" points="237.279,-42.6214 226.701,-43.2107 235.338,-49.3468 237.279,-42.6214"/>
</g>
<!-- sourcefile~main.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_node9" class="node"><title>sourcefile~main.f08</title>
<g id="a_sourcefile~~adjustments.f08~~AfferentGraph_node9"><a xlink:href=".././sourcefile/main.f08.html" xlink:title="main.f08">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="586,-63.1734 532,-63.1734 532,-39.1734 586,-39.1734 586,-63.1734"/>
<text text-anchor="middle" x="559" y="-48.7734" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main.f08</text>
</a>
</g>
</g>
<!-- sourcefile~main.f08&#45;&gt;sourcefile~time_loop.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge18" class="edge"><title>sourcefile~main.f08&#45;&gt;sourcefile~time_loop.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M531.858,-45.9186C523.909,-44.3209 514.914,-42.5129 506.014,-40.724"/>
<polygon fill="#000000" stroke="#000000" points="506.562,-37.2641 496.068,-38.7247 505.182,-44.1268 506.562,-37.2641"/>
</g>
<!-- sourcefile~main.f08&#45;&gt;sourcefile~initial_condition.f08 -->
<g id="sourcefile~~adjustments.f08~~AfferentGraph_edge19" class="edge"><title>sourcefile~main.f08&#45;&gt;sourcefile~initial_condition.f08</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M531.691,-53.7401C497.991,-57.0279 438.544,-62.8276 393.339,-67.2379"/>
<polygon fill="#000000" stroke="#000000" points="392.957,-63.7585 383.344,-68.213 393.636,-70.7254 392.957,-63.7585"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,-0 67,-0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,-0 182,-0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/adjustments.html">adjustments</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/adjustments.f08.html#src">adjustments.f08</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! module adjustments</span>
<a name="ln-2"></a><span class="c">!</span>
<a name="ln-3"></a><span class="c">! These are utility codes that make ad hoc adjustments to the simulation</span>
<a name="ln-4"></a><span class="c">! results. These are typically to prevent negative or zero values or</span>
<a name="ln-5"></a><span class="c">! to compensate for grid-scale oscillation.</span>
<a name="ln-6"></a><span class="c">!</span>
<a name="ln-7"></a><span class="c">!==========================================================================</span>
<a name="ln-8"></a><span class="c">!</span>
<a name="ln-9"></a> <span class="k">module </span><span class="n">adjustments</span>
<a name="ln-10"></a><span class="c">! </span>
<a name="ln-11"></a>    <span class="k">use </span><span class="n">array_index</span>
<a name="ln-12"></a>    <span class="k">use </span><span class="n">data_keys</span>
<a name="ln-13"></a>    <span class="k">use </span><span class="n">setting_definition</span>
<a name="ln-14"></a>    <span class="k">use </span><span class="n">globals</span>
<a name="ln-15"></a>    <span class="k">use </span><span class="n">utility</span>
<a name="ln-16"></a>    
<a name="ln-17"></a>    <span class="k">implicit none</span>
<a name="ln-18"></a><span class="k">    </span>
<a name="ln-19"></a><span class="k">    private</span>
<a name="ln-20"></a><span class="k">    </span>
<a name="ln-21"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">adjust_channel_velocity_limiter</span>
<a name="ln-22"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_junction_branch_velocity_limit</span>
<a name="ln-23"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_face_dynamic_limits</span>
<a name="ln-24"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_for_zero_geometry</span>
<a name="ln-25"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_negative_volume_reset</span>
<a name="ln-26"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_smallvolumes</span>
<a name="ln-27"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_Vshaped_flowrate</span>
<a name="ln-28"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">adjust_zero_velocity_at_zero_volume</span>
<a name="ln-29"></a>
<a name="ln-30"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">debuglevel</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-31"></a>    
<a name="ln-32"></a> <span class="k">contains</span>
<a name="ln-33"></a><span class="c">!</span>
<a name="ln-34"></a><span class="c">!========================================================================== </span>
<a name="ln-35"></a><span class="c">!==========================================================================</span>
<a name="ln-36"></a><span class="c">!</span>
<a name="ln-37"></a> <span class="k">subroutine </span><span class="n">adjust_channel_velocity_limiter</span> <span class="p">&amp;</span>
<a name="ln-38"></a>    <span class="p">(</span><span class="n">elemR</span><span class="p">,</span> <span class="n">elemYN</span><span class="p">,</span> <span class="n">elemI</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-39"></a>     <span class="n">ei_elem_type</span><span class="p">,</span> <span class="n">elemType</span><span class="p">,</span> <span class="n">eYN_IsAdhocFlowrate</span><span class="p">,</span> <span class="n">er_Velocity_new</span> <span class="p">)</span>
<a name="ln-40"></a><span class="c">!</span>
<a name="ln-41"></a><span class="c">!! Limits the velocity in channel elements to setting%Limiter%Velocity%Maximum</span>
<a name="ln-42"></a><span class="c">!! In general, this should only be needed where the volumes start getting small,</span>
<a name="ln-43"></a><span class="c">!! but also could accidentally mask (or delay) an instability.</span>
<a name="ln-44"></a><span class="c">!</span>
<a name="ln-45"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_channel_velocity_limiter&#39;</span>
<a name="ln-46"></a> 
<a name="ln-47"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemR</span><span class="p">(:,:)</span>
<a name="ln-48"></a> <span class="kt">logical</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemYN</span><span class="p">(:,:)</span>
<a name="ln-49"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemI</span><span class="p">(:,:)</span>
<a name="ln-50"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">ei_elem_type</span><span class="p">,</span> <span class="n">elemType</span><span class="p">,</span> <span class="n">eYN_IsAdhocFlowrate</span>
<a name="ln-51"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">er_Velocity_new</span>
<a name="ln-52"></a> 
<a name="ln-53"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span>  <span class="n">velocity</span><span class="p">(:)</span>
<a name="ln-54"></a> 
<a name="ln-55"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-56"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-57"></a> 
<a name="ln-58"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">UseLimitMax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-59"></a><span class="k">    </span><span class="n">velocity</span> <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Velocity_new</span><span class="p">)</span>
<a name="ln-60"></a>    
<a name="ln-61"></a>    <span class="k">where</span> <span class="p">(</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-62"></a>            <span class="p">(</span><span class="n">elemI</span><span class="p">(:,</span><span class="n">ei_elem_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">elemType</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-63"></a>            
<a name="ln-64"></a>        <span class="n">velocity</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">velocity</span> <span class="p">)</span>
<a name="ln-65"></a>        <span class="n">elemYN</span><span class="p">(:,</span><span class="n">eYN_IsAdhocFlowrate</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-66"></a>        
<a name="ln-67"></a>    <span class="n">endwhere</span> 
<a name="ln-68"></a>    
<a name="ln-69"></a> <span class="n">endif</span>
<a name="ln-70"></a>
<a name="ln-71"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-72"></a> <span class="k">end subroutine </span><span class="n">adjust_channel_velocity_limiter</span>
<a name="ln-73"></a><span class="c">!</span>
<a name="ln-74"></a><span class="c">!========================================================================== </span>
<a name="ln-75"></a><span class="c">!==========================================================================</span>
<a name="ln-76"></a><span class="c">!</span>
<a name="ln-77"></a> <span class="k">subroutine </span><span class="n">adjust_junction_branch_velocity_limit</span> <span class="p">&amp;</span>
<a name="ln-78"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">)</span>
<a name="ln-79"></a><span class="c">! </span>
<a name="ln-80"></a><span class="c">! This handles the velocity limiter only in junction branches,   </span>
<a name="ln-81"></a><span class="c">! Note that the channel elements and base junction velocity limits</span>
<a name="ln-82"></a><span class="c">! are enforced in a call to adjust_channel_velocity_limiter in the</span>
<a name="ln-83"></a><span class="c">! time marching.</span>
<a name="ln-84"></a><span class="c">!</span>
<a name="ln-85"></a><span class="c">! HACK - this could be cleaned up into 2 calls to a function, but be careful</span>
<a name="ln-86"></a><span class="c">! that we don&#39;t introduce pass-by-value.</span>
<a name="ln-87"></a><span class="c">!</span>
<a name="ln-88"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_junction_branch_velocity_limit&#39;</span>
<a name="ln-89"></a> 
<a name="ln-90"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-91"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemMI</span><span class="p">(:,:)</span>
<a name="ln-92"></a> 
<a name="ln-93"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">velocity</span><span class="p">(:),</span> <span class="n">flowrate</span><span class="p">(:),</span> <span class="n">area</span><span class="p">(:)</span>
<a name="ln-94"></a> 
<a name="ln-95"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mm</span>
<a name="ln-96"></a>  
<a name="ln-97"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-98"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-99"></a> 
<a name="ln-100"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">UseLimitMax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-101"></a><span class="k">    do </span><span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">upstream_face_per_elemM</span>
<a name="ln-102"></a>        <span class="n">velocity</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_VelocityUp</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span> 
<a name="ln-103"></a>        <span class="n">flowrate</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_FlowrateUp</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-104"></a>        <span class="n">area</span>     <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_AreaUp</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-105"></a>        <span class="k">where</span> <span class="p">(</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-106"></a>                <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMi_elem_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">eJunctionChannel</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-107"></a>                <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMi_nfaces_u</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">mm</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-108"></a>            <span class="n">velocity</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">velocity</span> <span class="p">)</span>
<a name="ln-109"></a>            <span class="n">flowrate</span> <span class="o">=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="n">area</span>
<a name="ln-110"></a>        <span class="n">endwhere</span>
<a name="ln-111"></a>    <span class="n">enddo</span>
<a name="ln-112"></a>    <span class="k">do </span><span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dnstream_face_per_elemM</span>
<a name="ln-113"></a>        <span class="n">velocity</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_VelocityDn</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span> 
<a name="ln-114"></a>        <span class="n">flowrate</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_FlowrateDn</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-115"></a>        <span class="n">area</span>     <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_AreaDn</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-116"></a>        <span class="k">where</span> <span class="p">(</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">limiter</span><span class="p">%</span><span class="n">velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">)</span>  <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-117"></a>                <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMi_elem_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">eJunctionChannel</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-118"></a>                <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMi_nfaces_d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">mm</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-119"></a>            <span class="n">velocity</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">velocity</span> <span class="p">)</span>
<a name="ln-120"></a>            <span class="n">flowrate</span> <span class="o">=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="n">area</span>
<a name="ln-121"></a>        <span class="n">endwhere</span>
<a name="ln-122"></a>    <span class="n">enddo</span>
<a name="ln-123"></a> <span class="n">endif</span>
<a name="ln-124"></a> 
<a name="ln-125"></a> <span class="k">nullify</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>
<a name="ln-126"></a> <span class="k">nullify</span><span class="p">(</span><span class="n">flowrate</span><span class="p">)</span>
<a name="ln-127"></a> <span class="k">nullify</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
<a name="ln-128"></a> 
<a name="ln-129"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-130"></a> <span class="k">end subroutine </span><span class="n">adjust_junction_branch_velocity_limit</span>
<a name="ln-131"></a><span class="c">!</span>
<a name="ln-132"></a><span class="c">!========================================================================== </span>
<a name="ln-133"></a><span class="c">!==========================================================================</span>
<a name="ln-134"></a><span class="c">!</span>
<a name="ln-135"></a> <span class="k">subroutine </span><span class="n">adjust_face_dynamic_limits</span> <span class="p">&amp;</span>
<a name="ln-136"></a>    <span class="p">(</span><span class="n">faceR</span><span class="p">,</span> <span class="n">faceI</span><span class="p">,</span> <span class="n">volumeUp</span><span class="p">,</span> <span class="n">volumeDn</span><span class="p">,</span> <span class="n">facemask</span><span class="p">,</span> <span class="n">Ltemp</span><span class="p">)</span>
<a name="ln-137"></a><span class="c">!</span>
<a name="ln-138"></a><span class="c">! ensures face velocity and areas are within limits</span>
<a name="ln-139"></a><span class="c">! </span>
<a name="ln-140"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_face_dynamic_limits&#39;</span>
<a name="ln-141"></a> 
<a name="ln-142"></a> <span class="kt">real</span><span class="p">,</span>                  <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">faceR</span><span class="p">(:,:)</span>
<a name="ln-143"></a> <span class="c">! note, requires that elemR be provided separately for upstream and downstream</span>
<a name="ln-144"></a> <span class="c">! these can be the samy arrays (e.g. in the case of elem2R for channel-channel)</span>
<a name="ln-145"></a> <span class="kt">real</span><span class="p">,</span>                  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">volumeUp</span><span class="p">(:),</span> <span class="n">volumeDn</span><span class="p">(:)</span>
<a name="ln-146"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">faceI</span><span class="p">(:,:)</span>
<a name="ln-147"></a> <span class="kt">logical</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">facemask</span><span class="p">(:),</span> <span class="n">Ltemp</span>
<a name="ln-148"></a> 
<a name="ln-149"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">volFrac</span>
<a name="ln-150"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">pointer</span> <span class="kd">::</span> <span class="n">eUp</span><span class="p">(:),</span> <span class="n">eDn</span><span class="p">(:)</span>
<a name="ln-151"></a>  
<a name="ln-152"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-153"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-154"></a>
<a name="ln-155"></a>
<a name="ln-156"></a>
<a name="ln-157"></a><span class="c">! Ad hoc limit the volume that can be transported out of the upstream cell. </span>
<a name="ln-158"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Flowrate</span><span class="p">%</span><span class="n">UseFaceVolumeTransport</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-159"></a><span class="k">    </span><span class="n">volFrac</span> <span class="o">=&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">flowrate</span><span class="p">%</span><span class="n">FaceVolumeTransport</span>
<a name="ln-160"></a>    <span class="n">eUp</span> <span class="o">=&gt;</span> <span class="n">faceI</span><span class="p">(:,</span><span class="n">fi_Melem_u</span><span class="p">)</span>
<a name="ln-161"></a>    <span class="n">eDn</span> <span class="o">=&gt;</span> <span class="n">faceI</span><span class="p">(:,</span><span class="n">fi_Melem_d</span><span class="p">)</span>
<a name="ln-162"></a><span class="c">!if (Ltemp) then</span>
<a name="ln-163"></a><span class="c">!    print *, trim(subroutine_name)</span>
<a name="ln-164"></a><span class="c">!    print *, facemask</span>
<a name="ln-165"></a><span class="c">!    print *, faceR(:,fr_flowrate)</span>
<a name="ln-166"></a><span class="c">!    print *, eUp</span>
<a name="ln-167"></a><span class="c">!    print *, volumeUp</span>
<a name="ln-168"></a><span class="c">!    print *, volumeUp(eUp)</span>
<a name="ln-169"></a><span class="c">!    print *, eDn</span>
<a name="ln-170"></a><span class="c">!    print *, volumeDn</span>
<a name="ln-171"></a><span class="c">!    !stop</span>
<a name="ln-172"></a><span class="c">!endif    </span>
<a name="ln-173"></a>    <span class="c">!%   for a downstream flow, limit flux from the upstream volume</span>
<a name="ln-174"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">)</span>  <span class="o">&gt;</span> <span class="n">zeroR</span><span class="p">))</span>
<a name="ln-175"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">)</span> <span class="o">=</span>  <span class="nb">min</span><span class="p">(</span><span class="n">volFrac</span> <span class="o">*</span> <span class="n">volumeUp</span><span class="p">(</span><span class="n">eUp</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span><span class="p">,</span> <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">))</span>
<a name="ln-176"></a>    <span class="n">endwhere</span>
<a name="ln-177"></a>   
<a name="ln-178"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zeroR</span> <span class="p">))</span>
<a name="ln-179"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">)</span> <span class="o">=</span>  <span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">volFrac</span> <span class="o">*</span> <span class="n">volumeDn</span><span class="p">(</span><span class="n">eDn</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span><span class="p">,</span> <span class="o">-</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_flowrate</span><span class="p">))</span>
<a name="ln-180"></a>    <span class="n">endwhere</span>
<a name="ln-181"></a>
<a name="ln-182"></a> <span class="n">endif</span>
<a name="ln-183"></a>
<a name="ln-184"></a><span class="c">!%  ensure face area is not smaller than zerovalue     </span>
<a name="ln-185"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">UseZeroValues</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-186"></a><span class="k">    where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">))</span>
<a name="ln-187"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_d</span><span class="p">)</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span>    
<a name="ln-188"></a>    <span class="n">endwhere</span>
<a name="ln-189"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">))</span>
<a name="ln-190"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_u</span><span class="p">)</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span>    
<a name="ln-191"></a>    <span class="n">endwhere</span> 
<a name="ln-192"></a>
<a name="ln-193"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">))</span>
<a name="ln-194"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_d</span><span class="p">)</span> <span class="o">=</span> <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Flowrate</span><span class="p">)</span> <span class="o">/</span> <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_d</span><span class="p">)</span>
<a name="ln-195"></a>    <span class="n">endwhere</span>
<a name="ln-196"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_u</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">))</span>
<a name="ln-197"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_u</span><span class="p">)</span> <span class="o">=</span> <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Flowrate</span><span class="p">)</span> <span class="o">/</span> <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Area_u</span><span class="p">)</span>
<a name="ln-198"></a>    <span class="n">endwhere</span>
<a name="ln-199"></a> <span class="n">endif</span>
<a name="ln-200"></a> 
<a name="ln-201"></a><span class="c">!%  limit high velocities</span>
<a name="ln-202"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">UseLimitMax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-203"></a><span class="k">    where</span> <span class="p">(</span> <span class="p">(</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span>  <span class="p">&amp;</span>
<a name="ln-204"></a>             <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_d</span><span class="p">))</span>  <span class="o">&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-205"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_d</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-206"></a>                                       <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_d</span><span class="p">)</span> <span class="p">)</span>        
<a name="ln-207"></a>    <span class="n">endwhere</span>
<a name="ln-208"></a>    <span class="k">where</span> <span class="p">(</span> <span class="p">(</span><span class="n">facemask</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span>  <span class="p">&amp;</span>
<a name="ln-209"></a>             <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_u</span><span class="p">))</span>  <span class="o">&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-210"></a>        <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_u</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">setting</span><span class="p">%</span><span class="n">Limiter</span><span class="p">%</span><span class="n">Velocity</span><span class="p">%</span><span class="n">Maximum</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-211"></a>                                       <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Velocity_u</span><span class="p">)</span> <span class="p">)</span>        
<a name="ln-212"></a>    <span class="n">endwhere</span>
<a name="ln-213"></a> <span class="n">endif</span>
<a name="ln-214"></a>
<a name="ln-215"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-216"></a> <span class="k">end subroutine </span><span class="n">adjust_face_dynamic_limits</span>
<a name="ln-217"></a><span class="c">!</span>
<a name="ln-218"></a><span class="c">!========================================================================== </span>
<a name="ln-219"></a><span class="c">!==========================================================================</span>
<a name="ln-220"></a><span class="c">!</span>
<a name="ln-221"></a> <span class="k">subroutine </span><span class="n">adjust_for_zero_geometry</span> <span class="p">&amp;</span>
<a name="ln-222"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">)</span>
<a name="ln-223"></a><span class="c">!</span>
<a name="ln-224"></a><span class="c">! resets geometry to user setting%ZeroValues where the geometry is too small</span>
<a name="ln-225"></a><span class="c">! </span>
<a name="ln-226"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_for_zero_geometry&#39;</span>
<a name="ln-227"></a> 
<a name="ln-228"></a> <span class="kt">real</span><span class="p">,</span>          <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">elem2R</span><span class="p">(:,:)</span>
<a name="ln-229"></a> <span class="kt">real</span><span class="p">,</span> <span class="k">target</span><span class="p">,</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-230"></a> <span class="kt">integer</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">elemMI</span><span class="p">(:,:)</span>
<a name="ln-231"></a> <span class="kt">logical</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">elem2YN</span><span class="p">(:,:),</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-232"></a> 
<a name="ln-233"></a> <span class="kt">real</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span> <span class="n">area</span><span class="p">(:),</span> <span class="n">topwidth</span><span class="p">(:)</span>
<a name="ln-234"></a> 
<a name="ln-235"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mm</span>
<a name="ln-236"></a>  
<a name="ln-237"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-238"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-239"></a> 
<a name="ln-240"></a><span class="c">!%  Handle channels </span>
<a name="ln-241"></a> <span class="k">call </span><span class="n">reset_element_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-242"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">e2r_Area</span><span class="p">,</span> <span class="n">e2r_Eta</span> <span class="p">,</span><span class="n">e2r_Zbottom</span><span class="p">,</span> <span class="n">e2r_Topwidth</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-243"></a>     <span class="n">e2r_Perimeter</span><span class="p">,</span> <span class="n">e2r_HydDepth</span><span class="p">,</span> <span class="n">e2r_HydRadius</span><span class="p">,</span> <span class="n">e2YN_IsSmallVolume</span><span class="p">)</span>
<a name="ln-244"></a>     
<a name="ln-245"></a><span class="c">!%  Handle central data for multi-branch junctions     </span>
<a name="ln-246"></a> <span class="k">call </span><span class="n">reset_element_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-247"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_Area</span><span class="p">,</span> <span class="n">eMr_Eta</span><span class="p">,</span> <span class="n">eMr_Zbottom</span><span class="p">,</span> <span class="n">eMr_Topwidth</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-248"></a>     <span class="n">eMr_Perimeter</span><span class="p">,</span> <span class="n">eMr_HydDepth</span><span class="p">,</span> <span class="n">eMr_HydRadius</span><span class="p">,</span> <span class="n">eMYN_IsSmallVolume</span><span class="p">)</span>    
<a name="ln-249"></a>     
<a name="ln-250"></a><span class="c">!%  Handle branch data for multi-branch junctions</span>
<a name="ln-251"></a><span class="c">!%  Upstream branches    </span>
<a name="ln-252"></a> <span class="k">call </span><span class="n">reset_juctionbranches_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-253"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaUp</span><span class="p">,</span> <span class="n">eMr_TopwidthUp</span><span class="p">,</span> <span class="n">eMi_nfaces_u</span><span class="p">,</span> <span class="n">upstream_face_per_elemM</span><span class="p">)</span>
<a name="ln-254"></a>    
<a name="ln-255"></a><span class="c">!%  Downstream branches</span>
<a name="ln-256"></a> <span class="k">call </span><span class="n">reset_juctionbranches_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-257"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaDn</span><span class="p">,</span> <span class="n">eMr_TopwidthDn</span><span class="p">,</span> <span class="n">eMi_nfaces_d</span><span class="p">,</span> <span class="n">dnstream_face_per_elemM</span><span class="p">)</span>
<a name="ln-258"></a> 
<a name="ln-259"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-260"></a> <span class="k">end subroutine </span><span class="n">adjust_for_zero_geometry</span>
<a name="ln-261"></a><span class="c">!</span>
<a name="ln-262"></a><span class="c">!========================================================================== </span>
<a name="ln-263"></a><span class="c">!==========================================================================</span>
<a name="ln-264"></a><span class="c">!</span>
<a name="ln-265"></a> <span class="k">subroutine </span><span class="n">adjust_negative_volume_reset</span> <span class="p">&amp;</span>
<a name="ln-266"></a>    <span class="p">(</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-267"></a><span class="c">!</span>
<a name="ln-268"></a><span class="c">! Ensures that any negative volumes are set to  setting%Zerovalue%Volume</span>
<a name="ln-269"></a><span class="c">! This is a limited routine called during time-stepping to ensure that</span>
<a name="ln-270"></a><span class="c">! we don&#39;t have a divide by zero (or small value) prior to the full </span>
<a name="ln-271"></a><span class="c">! geometry reset.</span>
<a name="ln-272"></a><span class="c">!</span>
<a name="ln-273"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_negative_volume_reset&#39;</span>
<a name="ln-274"></a> 
<a name="ln-275"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">volume</span><span class="p">(:)</span>
<a name="ln-276"></a>  
<a name="ln-277"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-278"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-279"></a> 
<a name="ln-280"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">UseZeroValues</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-281"></a><span class="k">    where</span> <span class="p">(</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span><span class="p">)</span>
<a name="ln-282"></a>        <span class="n">volume</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span>
<a name="ln-283"></a>    <span class="n">endwhere</span>
<a name="ln-284"></a> <span class="k">else</span>
<a name="ln-285"></a><span class="k">    where</span> <span class="p">(</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span>
<a name="ln-286"></a>        <span class="n">volume</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-287"></a>    <span class="n">endwhere</span>
<a name="ln-288"></a> <span class="n">endif</span>
<a name="ln-289"></a>
<a name="ln-290"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-291"></a> <span class="k">end subroutine </span><span class="n">adjust_negative_volume_reset</span>
<a name="ln-292"></a><span class="c">!</span>
<a name="ln-293"></a><span class="c">!========================================================================== </span>
<a name="ln-294"></a><span class="c">!==========================================================================</span>
<a name="ln-295"></a><span class="c">!</span>
<a name="ln-296"></a> <span class="k">subroutine </span><span class="n">adjust_smallvolumes</span> <span class="p">&amp;</span>
<a name="ln-297"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2I</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">e2r_VolumeColumn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-298"></a>     <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span><span class="p">)</span>
<a name="ln-299"></a><span class="c">!    </span>
<a name="ln-300"></a><span class="c">! Handle small volumes - ensures cells with depths that are at or below </span>
<a name="ln-301"></a><span class="c">! setting%SmallVolume%DepthCutoff have geometry set to small finite values</span>
<a name="ln-302"></a><span class="c">! from setting%SmallVolume%...</span>
<a name="ln-303"></a><span class="c">!</span>
<a name="ln-304"></a><span class="c">! Note that input includes specific VolumeColumn indexes so that the adjustments</span>
<a name="ln-305"></a><span class="c">! can be made to a temporary data column during the time march.</span>
<a name="ln-306"></a><span class="c">!</span>
<a name="ln-307"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_smallvolumes&#39;</span>
<a name="ln-308"></a>
<a name="ln-309"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elem2R</span><span class="p">(:,:),</span>  <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-310"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">elem2I</span><span class="p">(:,:),</span>  <span class="n">elemMI</span><span class="p">(:,:)</span>
<a name="ln-311"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elem2YN</span><span class="p">(:,:),</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-312"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">e2r_VolumeColumn</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span>
<a name="ln-313"></a>  
<a name="ln-314"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-315"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-316"></a> 
<a name="ln-317"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span> 
<a name="ln-318"></a>
<a name="ln-319"></a><span class="c">!%  Identify the small volumes and update the small volume ratio</span>
<a name="ln-320"></a><span class="c">!%  which are stored in elemYN(:,isSmallVolume) and elemR(:,SmallVolumeRatio)</span>
<a name="ln-321"></a> <span class="k">call </span><span class="n">smallvolume_identification</span> <span class="p">&amp;</span>
<a name="ln-322"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2I</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">e2r_VolumeColumn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-323"></a>     <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span> <span class="p">)</span>
<a name="ln-324"></a>    
<a name="ln-325"></a> <span class="k">call </span><span class="n">smallvolume_geometry</span> <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">)</span>    
<a name="ln-326"></a>     
<a name="ln-327"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-328"></a> <span class="k">end subroutine </span><span class="n">adjust_smallvolumes</span>
<a name="ln-329"></a><span class="c">!</span>
<a name="ln-330"></a><span class="c">!========================================================================== </span>
<a name="ln-331"></a><span class="c">!==========================================================================</span>
<a name="ln-332"></a><span class="c">!</span>
<a name="ln-333"></a> <span class="k">subroutine </span><span class="n">adjust_Vshaped_flowrate</span> <span class="p">&amp;</span>
<a name="ln-334"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">faceR</span><span class="p">,</span> <span class="n">elem2I</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">)</span>
<a name="ln-335"></a><span class="c">!</span>
<a name="ln-336"></a><span class="c">! Finds places where face flowrates and element flowrates are V-shaped</span>
<a name="ln-337"></a><span class="c">! The V is reduced by adjusting the element flowrate</span>
<a name="ln-338"></a><span class="c">!  </span>
<a name="ln-339"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_Vshaped_flowrate&#39;</span>
<a name="ln-340"></a> 
<a name="ln-341"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2R</span><span class="p">(:,:)</span>
<a name="ln-342"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">faceR</span><span class="p">(:,:)</span>
<a name="ln-343"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elem2I</span><span class="p">(:,:)</span>
<a name="ln-344"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2YN</span><span class="p">(:,:)</span>
<a name="ln-345"></a> 
<a name="ln-346"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">elemFlow</span><span class="p">(:),</span> <span class="n">faceFlow</span><span class="p">(:),</span> <span class="n">elemAdjust</span><span class="p">(:),</span> <span class="n">elemVel</span><span class="p">(:),</span> <span class="n">elemArea</span><span class="p">(:)</span>
<a name="ln-347"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">tscaleUp</span><span class="p">(:),</span> <span class="n">tscaleDn</span><span class="p">(:)</span>
<a name="ln-348"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">mapUp</span><span class="p">(:),</span> <span class="n">mapDn</span><span class="p">(:)</span>
<a name="ln-349"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">elemMask</span><span class="p">(:)</span>
<a name="ln-350"></a> 
<a name="ln-351"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">e2r_adjustflow</span><span class="p">,</span> <span class="n">e2YN_mask</span>
<a name="ln-352"></a> 
<a name="ln-353"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">pointer</span>     <span class="kd">::</span> <span class="n">coef</span>
<a name="ln-354"></a> 
<a name="ln-355"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-356"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-357"></a> 
<a name="ln-358"></a>
<a name="ln-359"></a> <span class="n">e2r_adjustflow</span> <span class="o">=</span> <span class="n">e2r_Temp</span><span class="p">(</span><span class="n">next_e2r_temparray</span><span class="p">)</span>
<a name="ln-360"></a> <span class="n">next_e2r_temparray</span> <span class="o">=</span> <span class="n">utility_advance_temp_array</span> <span class="p">(</span><span class="n">next_e2r_temparray</span><span class="p">,</span><span class="n">e2r_n_temp</span><span class="p">)</span>
<a name="ln-361"></a> 
<a name="ln-362"></a> <span class="n">e2YN_mask</span> <span class="o">=</span> <span class="n">e2YN_Temp</span><span class="p">(</span><span class="n">next_e2YN_temparray</span><span class="p">)</span>
<a name="ln-363"></a> <span class="n">next_e2YN_temparray</span> <span class="o">=</span> <span class="n">utility_advance_temp_array</span> <span class="p">(</span><span class="n">next_e2YN_temparray</span><span class="p">,</span><span class="n">e2YN_n_temp</span><span class="p">)</span>
<a name="ln-364"></a>
<a name="ln-365"></a> <span class="n">elemFlow</span>   <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Flowrate</span><span class="p">)</span>
<a name="ln-366"></a> <span class="n">elemVel</span>    <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Velocity</span><span class="p">)</span>
<a name="ln-367"></a> <span class="n">elemArea</span>   <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Area</span><span class="p">)</span>
<a name="ln-368"></a> <span class="n">tscaleUp</span>   <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Timescale_u</span><span class="p">)</span> 
<a name="ln-369"></a> <span class="n">tscaleDn</span>   <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Timescale_d</span><span class="p">)</span> 
<a name="ln-370"></a> <span class="n">elemAdjust</span> <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_adjustflow</span><span class="p">)</span>
<a name="ln-371"></a> 
<a name="ln-372"></a> <span class="n">elemMask</span>   <span class="o">=&gt;</span> <span class="n">elem2YN</span><span class="p">(:,</span><span class="n">e2YN_mask</span><span class="p">)</span>
<a name="ln-373"></a> <span class="n">elemMask</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-374"></a> 
<a name="ln-375"></a> <span class="n">faceFlow</span> <span class="o">=&gt;</span>  <span class="n">faceR</span><span class="p">(:,</span><span class="n">fr_Flowrate</span><span class="p">)</span>
<a name="ln-376"></a> 
<a name="ln-377"></a> <span class="n">mapUp</span> <span class="o">=&gt;</span> <span class="n">elem2I</span><span class="p">(:,</span><span class="n">e2i_Mface_u</span><span class="p">)</span>
<a name="ln-378"></a> <span class="n">mapDn</span> <span class="o">=&gt;</span> <span class="n">elem2I</span><span class="p">(:,</span><span class="n">e2i_Mface_d</span><span class="p">)</span>
<a name="ln-379"></a> 
<a name="ln-380"></a> <span class="n">elemAdjust</span> <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span> <span class="n">e2r_adjustflow</span><span class="p">)</span>
<a name="ln-381"></a> 
<a name="ln-382"></a> <span class="c">!% HACK - at this point only handling channel elements</span>
<a name="ln-383"></a> <span class="k">where</span> <span class="p">(</span><span class="n">elem2I</span><span class="p">(:,</span><span class="n">e2i_elem_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">eChannel</span><span class="p">)</span>
<a name="ln-384"></a>    <span class="n">elemMask</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-385"></a> <span class="n">endwhere</span>
<a name="ln-386"></a> 
<a name="ln-387"></a><span class="c">!%  Mask is the cells where the flowrate in the element is higher than both</span>
<a name="ln-388"></a><span class="c">!%  of the faces.</span>
<a name="ln-389"></a> <span class="k">where</span> <span class="p">(</span><span class="n">elemMask</span><span class="p">)</span>
<a name="ln-390"></a>    <span class="n">elemMask</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">utility_sign_with_ones</span><span class="p">(</span><span class="n">faceFlow</span><span class="p">(</span><span class="n">mapUp</span><span class="p">)</span> <span class="o">-</span> <span class="n">elemFlow</span><span class="p">))</span>      <span class="p">&amp;</span>
<a name="ln-391"></a>                <span class="o">*</span><span class="p">(</span><span class="n">utility_sign_with_ones</span><span class="p">(</span><span class="n">faceFlow</span><span class="p">(</span><span class="n">mapDn</span><span class="p">)</span> <span class="o">-</span> <span class="n">elemFlow</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-392"></a> <span class="n">endwhere</span>
<a name="ln-393"></a>   
<a name="ln-394"></a><span class="c">!%  The adjusted element flowrate is a linear weighting of face flowrates </span>
<a name="ln-395"></a><span class="c">!%  so that the face with the shorter timescale to reach has larger influence.</span>
<a name="ln-396"></a><span class="c">!%</span>
<a name="ln-397"></a><span class="c">!%  Arguably, this would likely be best using timescales, but we need to test</span>
<a name="ln-398"></a><span class="c">!%  this further  </span>
<a name="ln-399"></a><span class="c">! where (elemMask)  </span>
<a name="ln-400"></a><span class="c">!    elemAdjust =  (  tscaleUp * faceFlow(mapDn)   &amp;</span>
<a name="ln-401"></a><span class="c">!                   + tscaleDn * faceFlow(mapUp) ) &amp;</span>
<a name="ln-402"></a><span class="c">!                 / ( tscaleUp + tscaleDn )</span>
<a name="ln-403"></a><span class="c">! endwhere   </span>
<a name="ln-404"></a> <span class="k">where</span> <span class="p">(</span><span class="n">elemMask</span><span class="p">)</span>              
<a name="ln-405"></a>    <span class="n">elemAdjust</span> <span class="o">=</span>  <span class="p">(</span>  <span class="mf">0.5</span> <span class="o">*</span> <span class="n">faceFlow</span><span class="p">(</span><span class="n">mapDn</span><span class="p">)</span>   <span class="p">&amp;</span>
<a name="ln-406"></a>                   <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">faceFlow</span><span class="p">(</span><span class="n">mapUp</span><span class="p">)</span> <span class="p">)</span> 
<a name="ln-407"></a> <span class="n">endwhere</span>   
<a name="ln-408"></a>    
<a name="ln-409"></a><span class="c">!% apply a weighted combination based on the setting coefficient to damp the V </span>
<a name="ln-410"></a> <span class="n">coef</span> <span class="o">=&gt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Method</span><span class="p">%</span><span class="n">AdjustVshapedFlowrate</span><span class="p">%</span><span class="n">Coef</span>
<a name="ln-411"></a> <span class="k">where</span> <span class="p">(</span><span class="n">elemMask</span><span class="p">)</span>   
<a name="ln-412"></a>    <span class="n">elemFlow</span> <span class="o">=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">elemAdjust</span> <span class="o">+</span> <span class="p">(</span><span class="n">oneR</span> <span class="o">-</span> <span class="n">coef</span><span class="p">)</span> <span class="o">*</span> <span class="n">elemFlow</span>
<a name="ln-413"></a>    <span class="n">elemVel</span>  <span class="o">=</span> <span class="n">elemFlow</span> <span class="o">/</span> <span class="n">elemArea</span>
<a name="ln-414"></a> <span class="n">endwhere</span>
<a name="ln-415"></a> 
<a name="ln-416"></a><span class="c">!print *, elemFlow(size(elemFlow)-5:size(elemFlow))</span>
<a name="ln-417"></a>
<a name="ln-418"></a> 
<a name="ln-419"></a><span class="c">!%  close up the temp arrays </span>
<a name="ln-420"></a> <span class="n">elemAdjust</span> <span class="o">=</span> <span class="n">nullvalueR</span>
<a name="ln-421"></a> <span class="k">nullify</span><span class="p">(</span><span class="n">elemAdjust</span><span class="p">)</span>
<a name="ln-422"></a> <span class="n">next_e2r_temparray</span> <span class="o">=</span> <span class="n">next_e2r_temparray</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-423"></a> 
<a name="ln-424"></a> <span class="n">elemMask</span> <span class="o">=</span> <span class="n">nullvalueL</span>
<a name="ln-425"></a> <span class="k">nullify</span><span class="p">(</span><span class="n">elemMask</span><span class="p">)</span>
<a name="ln-426"></a> <span class="n">next_e2YN_temparray</span> <span class="o">=</span> <span class="n">next_e2YN_temparray</span><span class="o">-</span><span class="mi">1</span> 
<a name="ln-427"></a> 
<a name="ln-428"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-429"></a> <span class="k">end subroutine </span><span class="n">adjust_Vshaped_flowrate</span>
<a name="ln-430"></a><span class="c">!</span>
<a name="ln-431"></a><span class="c">!========================================================================== </span>
<a name="ln-432"></a><span class="c">!==========================================================================</span>
<a name="ln-433"></a><span class="c">!</span>
<a name="ln-434"></a> <span class="k">subroutine </span><span class="n">adjust_zero_velocity_at_zero_volume</span> <span class="p">&amp;</span>
<a name="ln-435"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">e2r_VelocityColumn</span><span class="p">,</span> <span class="n">e2r_VolumeColumn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-436"></a>     <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_VelocityColumn</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span><span class="p">)</span>
<a name="ln-437"></a><span class="c">!</span>
<a name="ln-438"></a><span class="c">! ensures that volumes smaller than the user limit have dynamics</span>
<a name="ln-439"></a><span class="c">! that are set to the user limit.</span>
<a name="ln-440"></a><span class="c">!</span>
<a name="ln-441"></a><span class="c">! This can create small non-zero momentum in the flow if the user minimums</span>
<a name="ln-442"></a><span class="c">! for setting%ZeroValue%Velocity, Flowrate are non-zero</span>
<a name="ln-443"></a><span class="c">!       </span>
<a name="ln-444"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;adjust_zero_velocity_at_zero_volume&#39;</span>
<a name="ln-445"></a> 
<a name="ln-446"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2R</span><span class="p">(:,:),</span>  <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-447"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2YN</span><span class="p">(:,:),</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-448"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">e2r_VelocityColumn</span><span class="p">,</span> <span class="n">e2r_VolumeColumn</span>
<a name="ln-449"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">eMr_VelocityColumn</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span>
<a name="ln-450"></a> 
<a name="ln-451"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-452"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-453"></a> 
<a name="ln-454"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">Volume</span> <span class="o">&gt;</span> <span class="n">zeroR</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-455"></a><span class="k"> </span>
<a name="ln-456"></a><span class="k">    call </span><span class="n">zero_velocity_at_zero_volume</span> <span class="p">&amp;</span>
<a name="ln-457"></a>        <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">e2r_VelocityColumn</span><span class="p">,</span> <span class="n">e2r_VolumeColumn</span><span class="p">,</span> <span class="n">e2YN_IsAdhocFlowrate</span> <span class="p">)</span>
<a name="ln-458"></a>    
<a name="ln-459"></a>    <span class="k">call </span><span class="n">zero_velocity_at_zero_volume</span> <span class="p">&amp;</span>
<a name="ln-460"></a>        <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_VelocityColumn</span><span class="p">,</span> <span class="n">eMr_VolumeColumn</span><span class="p">,</span> <span class="n">eMYN_IsAdhocFlowrate</span> <span class="p">)</span> 
<a name="ln-461"></a> <span class="n">endif</span>
<a name="ln-462"></a>    
<a name="ln-463"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-464"></a> <span class="k">end subroutine </span><span class="n">adjust_zero_velocity_at_zero_volume</span>  
<a name="ln-465"></a><span class="c">!</span>
<a name="ln-466"></a><span class="c">!========================================================================== </span>
<a name="ln-467"></a><span class="c">!</span>
<a name="ln-468"></a><span class="c">! PRIVATE BELOW HERE</span>
<a name="ln-469"></a><span class="c">!</span>
<a name="ln-470"></a><span class="c">!==========================================================================</span>
<a name="ln-471"></a><span class="c">!</span>
<a name="ln-472"></a> <span class="k">subroutine </span><span class="n">smallvolume_identification</span> <span class="p">&amp;</span>
<a name="ln-473"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2I</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="n">eTr_Volume2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-474"></a>     <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eTr_VolumeM</span> <span class="p">)</span>
<a name="ln-475"></a><span class="c">!</span>
<a name="ln-476"></a><span class="c">! updates small volume identification for different element types</span>
<a name="ln-477"></a><span class="c">!</span>
<a name="ln-478"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;smallvolume_identification&#39;</span>
<a name="ln-479"></a> 
<a name="ln-480"></a> <span class="kt">real</span><span class="p">,</span>    <span class="k">target</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2R</span><span class="p">(:,:),</span>  <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-481"></a> <span class="kt">integer</span><span class="p">,</span> <span class="k">target</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elem2I</span><span class="p">(:,:),</span>  <span class="n">elemMI</span><span class="p">(:,:)</span>
<a name="ln-482"></a> <span class="kt">logical</span><span class="p">,</span> <span class="k">target</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2YN</span><span class="p">(:,:),</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-483"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">eTr_Volume2</span><span class="p">,</span>  <span class="n">eTr_VolumeM</span> 
<a name="ln-484"></a> 
<a name="ln-485"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">pointer</span> <span class="kd">::</span> <span class="n">smallvolumeratio</span><span class="p">(:),</span> <span class="n">smallvolume</span><span class="p">(:),</span> <span class="n">tvolume</span><span class="p">(:)</span>
<a name="ln-486"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">pointer</span> <span class="kd">::</span> <span class="n">elemtype</span><span class="p">(:)</span>
<a name="ln-487"></a> 
<a name="ln-488"></a> <span class="kt">logical</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">issmallvolume</span><span class="p">(:)</span>
<a name="ln-489"></a> 
<a name="ln-490"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">thiselemtype</span>
<a name="ln-491"></a>  
<a name="ln-492"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-493"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-494"></a>
<a name="ln-495"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-496"></a> 
<a name="ln-497"></a><span class="c">!%  for channel elements</span>
<a name="ln-498"></a> <span class="n">smallvolumeratio</span>   <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_SmallvolumeRatio</span><span class="p">)</span>
<a name="ln-499"></a> <span class="n">smallvolume</span>        <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">e2r_Smallvolume</span><span class="p">)</span>
<a name="ln-500"></a> <span class="n">issmallvolume</span>      <span class="o">=&gt;</span> <span class="n">elem2YN</span><span class="p">(:,</span><span class="n">e2YN_IsSmallVolume</span><span class="p">)</span> 
<a name="ln-501"></a> <span class="n">tvolume</span>            <span class="o">=&gt;</span> <span class="n">elem2R</span><span class="p">(:,</span><span class="n">eTr_Volume2</span><span class="p">)</span>
<a name="ln-502"></a> <span class="n">elemtype</span>           <span class="o">=&gt;</span> <span class="n">elem2I</span><span class="p">(:,</span><span class="n">e2i_elem_type</span><span class="p">)</span>
<a name="ln-503"></a> <span class="n">thiselemtype</span> <span class="o">=</span> <span class="n">eChannel</span>
<a name="ln-504"></a>    
<a name="ln-505"></a> <span class="k">call </span><span class="n">smallvolume_identification_for_element</span> <span class="p">&amp;</span>
<a name="ln-506"></a>    <span class="p">(</span><span class="n">tvolume</span><span class="p">,</span> <span class="n">smallvolumeratio</span><span class="p">,</span> <span class="n">smallvolume</span><span class="p">,</span> <span class="n">issmallvolume</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-507"></a>     <span class="n">elemtype</span><span class="p">,</span> <span class="n">thiselemtype</span><span class="p">)</span>
<a name="ln-508"></a>
<a name="ln-509"></a><span class="c">!%  for junction elements  </span>
<a name="ln-510"></a> <span class="n">smallvolumeratio</span>   <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_SmallvolumeRatio</span><span class="p">)</span>
<a name="ln-511"></a> <span class="n">smallvolume</span>        <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_Smallvolume</span><span class="p">)</span> 
<a name="ln-512"></a> <span class="n">issmallvolume</span>      <span class="o">=&gt;</span> <span class="n">elemMYN</span><span class="p">(:,</span><span class="n">eMYN_IsSmallVolume</span><span class="p">)</span>
<a name="ln-513"></a> <span class="n">tvolume</span>            <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eTr_VolumeM</span><span class="p">)</span>
<a name="ln-514"></a> <span class="n">elemtype</span>           <span class="o">=&gt;</span> <span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMi_elem_type</span><span class="p">)</span>
<a name="ln-515"></a> <span class="n">thiselemtype</span> <span class="o">=</span> <span class="n">eJunctionChannel</span> 
<a name="ln-516"></a> 
<a name="ln-517"></a> <span class="k">call </span><span class="n">smallvolume_identification_for_element</span> <span class="p">&amp;</span>
<a name="ln-518"></a>    <span class="p">(</span><span class="n">tvolume</span><span class="p">,</span> <span class="n">smallvolumeratio</span><span class="p">,</span> <span class="n">smallvolume</span><span class="p">,</span> <span class="n">issmallvolume</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-519"></a>     <span class="n">elemtype</span><span class="p">,</span> <span class="n">thiselemtype</span><span class="p">)</span>  
<a name="ln-520"></a> 
<a name="ln-521"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-522"></a> <span class="k">end subroutine </span><span class="n">smallvolume_identification</span>
<a name="ln-523"></a><span class="c">!</span>
<a name="ln-524"></a><span class="c">!========================================================================== </span>
<a name="ln-525"></a><span class="c">!========================================================================== </span>
<a name="ln-526"></a><span class="c">!</span>
<a name="ln-527"></a> <span class="k">subroutine </span><span class="n">smallvolume_identification_for_element</span> <span class="p">&amp;</span>
<a name="ln-528"></a>    <span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">smallvolumeratio</span><span class="p">,</span> <span class="n">smallvolume</span><span class="p">,</span> <span class="n">issmallvolume</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-529"></a>     <span class="n">elemtype</span><span class="p">,</span> <span class="n">thiselementtype</span> <span class="p">)</span>
<a name="ln-530"></a><span class="c">!</span>
<a name="ln-531"></a><span class="c">! updates smallvolume identification for a single element type</span>
<a name="ln-532"></a><span class="c">!    </span>
<a name="ln-533"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;smallvolume_identification_for_element&#39;</span>
<a name="ln-534"></a> 
<a name="ln-535"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">volume</span><span class="p">(:),</span> <span class="n">smallvolumeratio</span><span class="p">(:)</span>
<a name="ln-536"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">smallvolume</span><span class="p">(:)</span>
<a name="ln-537"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemtype</span><span class="p">(:)</span>
<a name="ln-538"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">issmallvolume</span><span class="p">(:)</span>
<a name="ln-539"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">thiselementtype</span>
<a name="ln-540"></a> 
<a name="ln-541"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-542"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-543"></a> 
<a name="ln-544"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-545"></a>  
<a name="ln-546"></a><span class="c">!%  zero out small volumes (reset further below to setting%Zerovalue%Volume</span>
<a name="ln-547"></a><span class="c">!%  purpose is to ensure that volumes below the zero value will only use</span>
<a name="ln-548"></a><span class="c">!%  the Chezy-Manning approximation for flow.</span>
<a name="ln-549"></a><span class="c">!%  NOTE: this is a source of a small volume non-conservation of mass</span>
<a name="ln-550"></a> <span class="k">where</span> <span class="p">((</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">elemtype</span> <span class="o">==</span> <span class="n">thiselementtype</span><span class="p">))</span>
<a name="ln-551"></a>    <span class="n">volume</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-552"></a> <span class="n">endwhere</span>
<a name="ln-553"></a> 
<a name="ln-554"></a><span class="c">!%  Compute smallvolume_ratio where the local volume is small</span>
<a name="ln-555"></a><span class="c">!%  The ratio fraction used as a blending function in small volumes</span>
<a name="ln-556"></a><span class="c">!%  and is 1.0 where the element volume is exactly the small volume</span>
<a name="ln-557"></a> <span class="k">where</span> <span class="p">((</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">smallvolume</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">elemtype</span> <span class="o">==</span> <span class="n">thiselementtype</span><span class="p">))</span>
<a name="ln-558"></a>    <span class="n">issmallvolume</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-559"></a>    <span class="n">smallvolumeratio</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">/</span> <span class="n">smallvolume</span>
<a name="ln-560"></a> <span class="n">endwhere</span>
<a name="ln-561"></a> 
<a name="ln-562"></a><span class="c">!%  reset zero volumes to small volume value</span>
<a name="ln-563"></a> <span class="k">where</span> <span class="p">((</span><span class="n">volume</span> <span class="o">&lt;=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">elemtype</span> <span class="o">==</span> <span class="n">thiselementtype</span><span class="p">))</span>
<a name="ln-564"></a>    <span class="n">volume</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span>
<a name="ln-565"></a> <span class="n">endwhere</span>
<a name="ln-566"></a>  
<a name="ln-567"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-568"></a> <span class="k">end subroutine </span><span class="n">smallvolume_identification_for_element</span>   
<a name="ln-569"></a><span class="c">!</span>
<a name="ln-570"></a><span class="c">!========================================================================== </span>
<a name="ln-571"></a><span class="c">!========================================================================== </span>
<a name="ln-572"></a><span class="c">!</span>
<a name="ln-573"></a> <span class="k">subroutine </span><span class="n">smallvolume_geometry</span> <span class="p">&amp;</span>
<a name="ln-574"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-575"></a>     <span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">)</span>
<a name="ln-576"></a><span class="c">!</span>
<a name="ln-577"></a><span class="c">! adjusts geometry that are designated as &quot;smallvolume&quot;, which are derived</span>
<a name="ln-578"></a><span class="c">! from the setting%SmallDepth </span>
<a name="ln-579"></a><span class="c">!</span>
<a name="ln-580"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;smallvolume_geometry&#39;</span>
<a name="ln-581"></a>
<a name="ln-582"></a> <span class="kt">real</span><span class="p">,</span>          <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elem2R</span><span class="p">(:,:)</span>
<a name="ln-583"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">target</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-584"></a> <span class="kt">logical</span><span class="p">,</span>       <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elem2YN</span><span class="p">(:,:),</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-585"></a> 
<a name="ln-586"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">area</span><span class="p">(:),</span> <span class="n">topwidth</span><span class="p">(:)</span>
<a name="ln-587"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mm</span>
<a name="ln-588"></a>  
<a name="ln-589"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-590"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-591"></a> 
<a name="ln-592"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-593"></a> 
<a name="ln-594"></a><span class="c">!%  channel elements</span>
<a name="ln-595"></a> <span class="k">call </span><span class="n">smallvolume_element_geometry_reset</span> <span class="p">&amp;</span>
<a name="ln-596"></a>    <span class="p">(</span><span class="n">elem2R</span><span class="p">,</span> <span class="n">elem2YN</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-597"></a>     <span class="n">e2r_Area</span><span class="p">,</span> <span class="n">e2r_Eta</span><span class="p">,</span> <span class="n">e2r_Perimeter</span><span class="p">,</span> <span class="n">e2r_Zbottom</span><span class="p">,</span> <span class="n">e2r_HydDepth</span><span class="p">,</span> <span class="n">e2r_HydRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-598"></a>     <span class="n">e2r_Topwidth</span><span class="p">,</span> <span class="n">e2YN_IsSmallVolume</span><span class="p">)</span>
<a name="ln-599"></a>
<a name="ln-600"></a><span class="c">!%  junction elements</span>
<a name="ln-601"></a> <span class="k">call </span><span class="n">smallvolume_element_geometry_reset</span> <span class="p">&amp;</span>
<a name="ln-602"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-603"></a>     <span class="n">eMr_Area</span><span class="p">,</span> <span class="n">eMr_Eta</span><span class="p">,</span> <span class="n">eMr_Perimeter</span><span class="p">,</span> <span class="n">eMr_Zbottom</span><span class="p">,</span> <span class="n">eMr_HydDepth</span><span class="p">,</span> <span class="n">eMr_HydRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-604"></a>     <span class="n">eMr_Topwidth</span><span class="p">,</span> <span class="n">eMYN_IsSmallVolume</span><span class="p">)</span> 
<a name="ln-605"></a>
<a name="ln-606"></a><span class="c">!%  junction branches  </span>
<a name="ln-607"></a> <span class="k">call </span><span class="n">smallvolume_junctionbranch_reset</span> <span class="p">&amp;</span>
<a name="ln-608"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaUp</span><span class="p">,</span> <span class="n">eMr_TopwidthUp</span><span class="p">,</span> <span class="n">upstream_face_per_elemM</span><span class="p">)</span>  
<a name="ln-609"></a>
<a name="ln-610"></a> <span class="k">call </span><span class="n">smallvolume_junctionbranch_reset</span> <span class="p">&amp;</span>
<a name="ln-611"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaDn</span><span class="p">,</span> <span class="n">eMr_TopwidthDn</span><span class="p">,</span> <span class="n">dnstream_face_per_elemM</span><span class="p">)</span>  
<a name="ln-612"></a>
<a name="ln-613"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-614"></a> <span class="k">end subroutine </span><span class="n">smallvolume_geometry</span>
<a name="ln-615"></a><span class="c">!</span>
<a name="ln-616"></a><span class="c">!========================================================================== </span>
<a name="ln-617"></a><span class="c">!========================================================================== </span>
<a name="ln-618"></a><span class="c">!</span>
<a name="ln-619"></a> <span class="k">subroutine </span><span class="n">smallvolume_element_geometry_reset</span> <span class="p">&amp;</span>
<a name="ln-620"></a>    <span class="p">(</span><span class="n">elemR</span><span class="p">,</span> <span class="n">elemYN</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-621"></a>     <span class="n">er_Area</span><span class="p">,</span> <span class="n">er_Eta</span><span class="p">,</span> <span class="n">er_Perimeter</span><span class="p">,</span> <span class="n">er_Zbottom</span><span class="p">,</span> <span class="n">er_HydDepth</span><span class="p">,</span> <span class="n">er_HydRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-622"></a>     <span class="n">er_Topwidth</span><span class="p">,</span> <span class="n">eYN_IsSmallVolume</span><span class="p">)</span>
<a name="ln-623"></a><span class="c">!</span>
<a name="ln-624"></a><span class="c">! for small volumes, reset the geometry to the setting%smallvolume values</span>
<a name="ln-625"></a><span class="c">!   </span>
<a name="ln-626"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;smallvolume_element_geometry_reset&#39;</span>
<a name="ln-627"></a> 
<a name="ln-628"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">target</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemR</span><span class="p">(:,:)</span>
<a name="ln-629"></a>
<a name="ln-630"></a> <span class="kt">logical</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemYN</span><span class="p">(:,:)</span>
<a name="ln-631"></a> 
<a name="ln-632"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">er_Area</span><span class="p">,</span> <span class="n">er_Eta</span><span class="p">,</span> <span class="n">er_Perimeter</span><span class="p">,</span> <span class="n">er_Zbottom</span>
<a name="ln-633"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">er_HydDepth</span><span class="p">,</span> <span class="n">er_HydRadius</span><span class="p">,</span> <span class="n">er_Topwidth</span>
<a name="ln-634"></a> <span class="kt">integer</span><span class="p">,</span>   <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">eYN_IsSmallVolume</span>
<a name="ln-635"></a> 
<a name="ln-636"></a> <span class="kt">real</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span>  <span class="n">area</span><span class="p">(:),</span> <span class="n">eta</span><span class="p">(:),</span> <span class="n">perimeter</span><span class="p">(:),</span> <span class="n">zbottom</span><span class="p">(:)</span>
<a name="ln-637"></a> <span class="kt">real</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span>  <span class="n">hyddepth</span><span class="p">(:),</span> <span class="n">hydradius</span><span class="p">(:)</span>
<a name="ln-638"></a> <span class="kt">real</span><span class="p">,</span> <span class="k">pointer</span>  <span class="kd">::</span>  <span class="n">topwidth</span><span class="p">(:)</span> 
<a name="ln-639"></a>
<a name="ln-640"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-641"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-642"></a>
<a name="ln-643"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-644"></a><span class="k"> </span>
<a name="ln-645"></a><span class="k"> </span><span class="n">area</span>               <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Area</span><span class="p">)</span>
<a name="ln-646"></a> <span class="n">perimeter</span>          <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Perimeter</span><span class="p">)</span>
<a name="ln-647"></a> <span class="n">hyddepth</span>           <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Hyddepth</span><span class="p">)</span>
<a name="ln-648"></a> <span class="n">hydradius</span>          <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Hydradius</span><span class="p">)</span>
<a name="ln-649"></a> <span class="n">topwidth</span>           <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Topwidth</span><span class="p">)</span>
<a name="ln-650"></a> <span class="n">eta</span>                <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Eta</span><span class="p">)</span>
<a name="ln-651"></a> <span class="n">zbottom</span>            <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Zbottom</span><span class="p">)</span>
<a name="ln-652"></a> 
<a name="ln-653"></a> <span class="k">where</span> <span class="p">(</span><span class="n">elemYN</span><span class="p">(:,</span><span class="n">eYN_IsSmallVolume</span><span class="p">))</span>
<a name="ln-654"></a>    <span class="n">area</span>        <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumArea</span>
<a name="ln-655"></a>    <span class="n">perimeter</span>   <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumTopwidth</span>
<a name="ln-656"></a>    <span class="n">hyddepth</span>    <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">DepthCutoff</span>
<a name="ln-657"></a>    <span class="n">hydradius</span>   <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumHydRadius</span>
<a name="ln-658"></a>    <span class="n">topwidth</span>    <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumTopwidth</span>
<a name="ln-659"></a>    <span class="n">eta</span>         <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">DepthCutoff</span> <span class="o">+</span> <span class="n">zbottom</span>
<a name="ln-660"></a> <span class="n">endwhere</span>
<a name="ln-661"></a>
<a name="ln-662"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-663"></a> <span class="k">end subroutine </span><span class="n">smallvolume_element_geometry_reset</span>
<a name="ln-664"></a><span class="c">!</span>
<a name="ln-665"></a><span class="c">!========================================================================== </span>
<a name="ln-666"></a><span class="c">!==========================================================================</span>
<a name="ln-667"></a><span class="c">!</span>
<a name="ln-668"></a> <span class="k">subroutine </span><span class="n">smallvolume_junctionbranch_reset</span> <span class="p">&amp;</span>
<a name="ln-669"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaDir</span><span class="p">,</span> <span class="n">eMr_TopwidthDir</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-670"></a>     <span class="n">Dir_face_per_elem</span><span class="p">)</span>
<a name="ln-671"></a><span class="c">!</span>
<a name="ln-672"></a><span class="c">! reset the values for branches in a junction that has a smallvolume</span>
<a name="ln-673"></a><span class="c">! </span>
<a name="ln-674"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;smallvolume_junctionbranch_reset&#39;</span>
<a name="ln-675"></a> 
<a name="ln-676"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-677"></a> <span class="kt">logical</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-678"></a> 
<a name="ln-679"></a> <span class="c">! dnstream_face_per_elemM or upstream_face_per_elemM</span>
<a name="ln-680"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">Dir_face_per_elem</span> 
<a name="ln-681"></a> <span class="kt">integer</span><span class="p">,</span>           <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">eMr_AreaDir</span><span class="p">(:),</span> <span class="n">eMr_TopwidthDir</span><span class="p">(:)</span>
<a name="ln-682"></a> 
<a name="ln-683"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">area</span><span class="p">(:),</span> <span class="n">topwidth</span><span class="p">(:)</span>
<a name="ln-684"></a> <span class="kt">integer</span>        <span class="kd">::</span> <span class="n">mm</span>
<a name="ln-685"></a> 
<a name="ln-686"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-687"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-688"></a> 
<a name="ln-689"></a> <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">UseSmallVolumes</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-690"></a><span class="k"> </span>
<a name="ln-691"></a><span class="k"> do </span><span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Dir_face_per_elem</span>
<a name="ln-692"></a>    <span class="n">area</span>     <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_AreaDir</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-693"></a>    <span class="n">topwidth</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_TopwidthDir</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>   
<a name="ln-694"></a>    <span class="k">where</span> <span class="p">(</span><span class="n">elemMYN</span><span class="p">(:,</span><span class="n">eMYN_IsSmallVolume</span><span class="p">))</span>
<a name="ln-695"></a>        <span class="n">topwidth</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumTopwidth</span>
<a name="ln-696"></a>        <span class="n">area</span>     <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">SmallVolume</span><span class="p">%</span><span class="n">MinimumArea</span>
<a name="ln-697"></a>    <span class="n">endwhere</span>    
<a name="ln-698"></a> <span class="n">enddo</span>
<a name="ln-699"></a> 
<a name="ln-700"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-701"></a> <span class="k">end subroutine </span><span class="n">smallvolume_junctionbranch_reset</span>
<a name="ln-702"></a><span class="c">!</span>
<a name="ln-703"></a><span class="c">!========================================================================== </span>
<a name="ln-704"></a><span class="c">!========================================================================== </span>
<a name="ln-705"></a><span class="c">!</span>
<a name="ln-706"></a> <span class="k">subroutine </span><span class="n">reset_element_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-707"></a>    <span class="p">(</span><span class="n">elemR</span><span class="p">,</span> <span class="n">elemYN</span><span class="p">,</span> <span class="n">er_Area</span><span class="p">,</span> <span class="n">er_Eta</span><span class="p">,</span> <span class="n">er_Zbottom</span><span class="p">,</span> <span class="n">er_Topwidth</span><span class="p">,</span> <span class="n">er_Perimeter</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-708"></a>     <span class="n">er_HydDepth</span><span class="p">,</span> <span class="n">er_HydRadius</span><span class="p">,</span> <span class="n">eYN_IsSmallVolume</span><span class="p">)</span>
<a name="ln-709"></a><span class="c">!</span>
<a name="ln-710"></a><span class="c">! Adjusts miscellaneous geometry for small or negative values</span>
<a name="ln-711"></a><span class="c">! Note thismask is true only where elemYN(:,IsSmallVolume) is false). </span>
<a name="ln-712"></a><span class="c">! That is, this only applies to elements NOT covered by the small volume </span>
<a name="ln-713"></a><span class="c">! algorithm.</span>
<a name="ln-714"></a><span class="c">!</span>
<a name="ln-715"></a><span class="c">! In general, this should not be needed, but is provided in case the</span>
<a name="ln-716"></a><span class="c">! setting%SmallVolume algorithm is turned off or if some degenerate case</span>
<a name="ln-717"></a><span class="c">! occurs where the volume is large but the element geometry is small.</span>
<a name="ln-718"></a><span class="c">!    </span>
<a name="ln-719"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;reset_element_for_zero_values&#39;</span>
<a name="ln-720"></a> 
<a name="ln-721"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">target</span><span class="p">,</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">elemR</span><span class="p">(:,:)</span>
<a name="ln-722"></a> <span class="kt">logical</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">elemYN</span><span class="p">(:,:)</span>
<a name="ln-723"></a> 
<a name="ln-724"></a> <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">er_Area</span><span class="p">,</span> <span class="n">er_Eta</span><span class="p">,</span> <span class="n">er_Zbottom</span><span class="p">,</span> <span class="n">er_Topwidth</span>
<a name="ln-725"></a> <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">er_Perimeter</span><span class="p">,</span> <span class="n">er_HydDepth</span><span class="p">,</span> <span class="n">er_HydRadius</span>
<a name="ln-726"></a> <span class="kt">integer</span><span class="p">,</span>        <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">eYN_IsSmallVolume</span>
<a name="ln-727"></a> 
<a name="ln-728"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">area</span><span class="p">(:),</span> <span class="n">eta</span><span class="p">(:),</span> <span class="n">topwidth</span><span class="p">(:),</span> <span class="n">perimeter</span><span class="p">(:)</span> 
<a name="ln-729"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">zbottom</span><span class="p">(:),</span> <span class="n">hyddepth</span><span class="p">(:),</span> <span class="n">hydradius</span><span class="p">(:)</span>
<a name="ln-730"></a> 
<a name="ln-731"></a> <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span>
<a name="ln-732"></a>
<a name="ln-733"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-734"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-735"></a>
<a name="ln-736"></a> <span class="n">area</span>       <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Area</span><span class="p">)</span>
<a name="ln-737"></a> <span class="n">eta</span>        <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Eta</span><span class="p">)</span>
<a name="ln-738"></a> <span class="n">topwidth</span>   <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Topwidth</span><span class="p">)</span>
<a name="ln-739"></a> <span class="n">perimeter</span>  <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Perimeter</span><span class="p">)</span>
<a name="ln-740"></a> <span class="n">hyddepth</span>   <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_HydDepth</span><span class="p">)</span>
<a name="ln-741"></a> <span class="n">hydradius</span>  <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_HydRadius</span><span class="p">)</span>
<a name="ln-742"></a> <span class="n">zbottom</span>    <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Zbottom</span><span class="p">)</span>
<a name="ln-743"></a> 
<a name="ln-744"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">UseZeroValues</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-745"></a><span class="k">    where</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">elemYN</span><span class="p">(:,</span><span class="n">eYN_IsSmallVolume</span><span class="p">))</span>
<a name="ln-746"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">)</span> 
<a name="ln-747"></a>            <span class="n">area</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span>
<a name="ln-748"></a>        <span class="n">endwhere</span>
<a name="ln-749"></a>
<a name="ln-750"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">eta</span> <span class="o">-</span> <span class="n">zbottom</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span><span class="p">)</span> 
<a name="ln-751"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="n">zbottom</span> <span class="o">+</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span>
<a name="ln-752"></a>        <span class="n">endwhere</span>
<a name="ln-753"></a>        
<a name="ln-754"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">topwidth</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span><span class="p">)</span> 
<a name="ln-755"></a>            <span class="n">topwidth</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span>
<a name="ln-756"></a>        <span class="n">endwhere</span>
<a name="ln-757"></a>        
<a name="ln-758"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">perimeter</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span><span class="p">)</span> 
<a name="ln-759"></a>            <span class="n">perimeter</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span>
<a name="ln-760"></a>        <span class="n">endwhere</span>
<a name="ln-761"></a>        
<a name="ln-762"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">hyddepth</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span><span class="p">)</span>
<a name="ln-763"></a>            <span class="n">hyddepth</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span>
<a name="ln-764"></a>        <span class="n">endwhere</span>
<a name="ln-765"></a>        
<a name="ln-766"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">hydradius</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span><span class="p">)</span>
<a name="ln-767"></a>            <span class="n">hydradius</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Depth</span>
<a name="ln-768"></a>        <span class="n">endwhere</span>
<a name="ln-769"></a>    <span class="n">endwhere</span>
<a name="ln-770"></a> <span class="k">else</span>
<a name="ln-771"></a><span class="k">    where</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">elemYN</span><span class="p">(:,</span><span class="n">eYN_IsSmallVolume</span><span class="p">))</span>
<a name="ln-772"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span> 
<a name="ln-773"></a>            <span class="n">area</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-774"></a>        <span class="n">endwhere</span>
<a name="ln-775"></a>
<a name="ln-776"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">eta</span> <span class="o">-</span> <span class="n">zbottom</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span> 
<a name="ln-777"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="n">zbottom</span> 
<a name="ln-778"></a>        <span class="n">endwhere</span>
<a name="ln-779"></a>        
<a name="ln-780"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">topwidth</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span> 
<a name="ln-781"></a>            <span class="n">topwidth</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-782"></a>        <span class="n">endwhere</span>
<a name="ln-783"></a>        
<a name="ln-784"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">perimeter</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span> 
<a name="ln-785"></a>            <span class="n">perimeter</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-786"></a>        <span class="n">endwhere</span>
<a name="ln-787"></a>        
<a name="ln-788"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">hyddepth</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span>
<a name="ln-789"></a>            <span class="n">hyddepth</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-790"></a>        <span class="n">endwhere</span>
<a name="ln-791"></a>        
<a name="ln-792"></a>        <span class="k">where</span> <span class="p">(</span><span class="n">hydradius</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span>
<a name="ln-793"></a>            <span class="n">hydradius</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-794"></a>        <span class="n">endwhere</span>
<a name="ln-795"></a>    <span class="n">endwhere</span>
<a name="ln-796"></a> <span class="n">endif</span>
<a name="ln-797"></a> 
<a name="ln-798"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-799"></a> <span class="k">end subroutine </span><span class="n">reset_element_for_zero_values</span>   
<a name="ln-800"></a><span class="c">!</span>
<a name="ln-801"></a><span class="c">!========================================================================== </span>
<a name="ln-802"></a><span class="c">!==========================================================================</span>
<a name="ln-803"></a><span class="c">!</span>
<a name="ln-804"></a> <span class="k">subroutine </span><span class="n">reset_juctionbranches_for_zero_values</span> <span class="p">&amp;</span>
<a name="ln-805"></a>    <span class="p">(</span><span class="n">elemMR</span><span class="p">,</span> <span class="n">elemMI</span><span class="p">,</span> <span class="n">elemMYN</span><span class="p">,</span> <span class="n">eMr_AreaDir</span><span class="p">,</span> <span class="n">eMr_TopwidthDir</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-806"></a>     <span class="n">eMr_nfaces_Dir</span><span class="p">,</span> <span class="n">Dir_face_per_elemM</span><span class="p">)</span>
<a name="ln-807"></a><span class="c">!</span>
<a name="ln-808"></a><span class="c">! resets values below the zero value to the zero value in</span>
<a name="ln-809"></a><span class="c">! junction branches. Applied separately for upstream and downstream branches.</span>
<a name="ln-810"></a><span class="c">! </span>
<a name="ln-811"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;reset_juctionbranches_for_zero_values&#39;</span>
<a name="ln-812"></a> 
<a name="ln-813"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemMR</span><span class="p">(:,:)</span>
<a name="ln-814"></a> <span class="kt">integer</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemMI</span><span class="p">(:,:)</span>
<a name="ln-815"></a> <span class="kt">logical</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">elemMYN</span><span class="p">(:,:)</span>
<a name="ln-816"></a> <span class="kt">integer</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">Dir_face_per_elemM</span><span class="p">,</span> <span class="n">eMr_nfaces_Dir</span>
<a name="ln-817"></a> <span class="kt">integer</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">eMr_AreaDir</span><span class="p">(:),</span> <span class="n">eMr_TopwidthDir</span><span class="p">(:)</span>
<a name="ln-818"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">area</span><span class="p">(:),</span> <span class="n">topwidth</span><span class="p">(:)</span>
<a name="ln-819"></a> <span class="kt">integer</span>        <span class="kd">::</span> <span class="n">mm</span>
<a name="ln-820"></a>  
<a name="ln-821"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-822"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-823"></a> 
<a name="ln-824"></a> <span class="k">do </span><span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Dir_face_per_elemM</span>
<a name="ln-825"></a>    <span class="n">area</span>     <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_AreaDir</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-826"></a>    <span class="n">topwidth</span> <span class="o">=&gt;</span> <span class="n">elemMR</span><span class="p">(:,</span><span class="n">eMr_TopwidthDir</span><span class="p">(</span><span class="n">mm</span><span class="p">))</span>
<a name="ln-827"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">UseZeroValues</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-828"></a><span class="k">        where</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span> <span class="n">elemMYN</span><span class="p">(:,</span><span class="n">eMYN_IsSmallVolume</span><span class="p">))</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMr_nfaces_Dir</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">mm</span><span class="p">))</span>
<a name="ln-829"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-830"></a>                <span class="n">area</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Area</span>
<a name="ln-831"></a>            <span class="n">endwhere</span>    
<a name="ln-832"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">topwidth</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span><span class="p">)</span>
<a name="ln-833"></a>                <span class="n">topwidth</span> <span class="o">=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span>
<a name="ln-834"></a>            <span class="n">endwhere</span>   
<a name="ln-835"></a>        <span class="n">endwhere</span>
<a name="ln-836"></a>    <span class="k">else</span>
<a name="ln-837"></a><span class="k">        where</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span> <span class="n">elemMYN</span><span class="p">(:,</span><span class="n">eMYN_IsSmallVolume</span><span class="p">))</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">elemMI</span><span class="p">(:,</span><span class="n">eMr_nfaces_Dir</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">mm</span><span class="p">))</span>
<a name="ln-838"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">zeroR</span><span class="p">)</span>
<a name="ln-839"></a>                <span class="n">area</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-840"></a>            <span class="n">endwhere</span>    
<a name="ln-841"></a>            <span class="k">where</span> <span class="p">(</span><span class="n">topwidth</span> <span class="o">&lt;</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Topwidth</span><span class="p">)</span>
<a name="ln-842"></a>                <span class="n">topwidth</span> <span class="o">=</span> <span class="n">zeroR</span>
<a name="ln-843"></a>            <span class="n">endwhere</span>   
<a name="ln-844"></a>        <span class="n">endwhere</span>
<a name="ln-845"></a>    <span class="n">endif</span>
<a name="ln-846"></a> <span class="n">enddo</span>
<a name="ln-847"></a> 
<a name="ln-848"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-849"></a> <span class="k">end subroutine </span><span class="n">reset_juctionbranches_for_zero_values</span>
<a name="ln-850"></a><span class="c">!</span>
<a name="ln-851"></a><span class="c">!========================================================================== </span>
<a name="ln-852"></a><span class="c">!==========================================================================</span>
<a name="ln-853"></a><span class="c">!</span>
<a name="ln-854"></a> <span class="k">subroutine </span><span class="n">zero_velocity_at_zero_volume</span> <span class="p">&amp;</span>
<a name="ln-855"></a>    <span class="p">(</span><span class="n">elemR</span><span class="p">,</span> <span class="n">elemYN</span><span class="p">,</span> <span class="n">er_Velocity</span><span class="p">,</span> <span class="n">er_Volume</span><span class="p">,</span> <span class="n">eYN_IsAdhocFlowrate</span> <span class="p">)</span>
<a name="ln-856"></a><span class="c">!</span>
<a name="ln-857"></a><span class="c">! sets velocity to minimal values if the volume is less</span>
<a name="ln-858"></a><span class="c">! than the user minimum. Note that this should only apply in volumes that</span>
<a name="ln-859"></a><span class="c">! are &lt;&lt; elemR(:,Smallvolume)</span>
<a name="ln-860"></a><span class="c">!</span>
<a name="ln-861"></a> <span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subroutine_name</span> <span class="o">=</span> <span class="s1">&#39;zero_velocity_at_zero_volume&#39;</span>
<a name="ln-862"></a> 
<a name="ln-863"></a> <span class="kt">real</span><span class="p">,</span>      <span class="k">target</span><span class="p">,</span>     <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemR</span><span class="p">(:,:)</span>
<a name="ln-864"></a> <span class="kt">logical</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span> <span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">elemYN</span><span class="p">(:,:)</span>
<a name="ln-865"></a> <span class="kt">integer</span><span class="p">,</span>               <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">er_Velocity</span><span class="p">,</span> <span class="n">er_Volume</span><span class="p">,</span> <span class="n">eYN_IsAdhocFlowrate</span>
<a name="ln-866"></a> 
<a name="ln-867"></a> <span class="kt">real</span><span class="p">,</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">velocity</span><span class="p">(:),</span>  <span class="n">volume</span><span class="p">(:)</span>
<a name="ln-868"></a>  
<a name="ln-869"></a><span class="c">!-------------------------------------------------------------------------- </span>
<a name="ln-870"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** enter &#39;</span><span class="p">,</span><span class="n">subroutine_name</span> 
<a name="ln-871"></a> 
<a name="ln-872"></a> <span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">ZeroValue</span><span class="p">%</span><span class="n">Volume</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-873"></a><span class="k">    </span><span class="n">velocity</span> <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Velocity</span><span class="p">)</span>
<a name="ln-874"></a>    <span class="n">volume</span>   <span class="o">=&gt;</span> <span class="n">elemR</span><span class="p">(:,</span><span class="n">er_Volume</span><span class="p">)</span>
<a name="ln-875"></a>    <span class="k">where</span> <span class="p">(</span><span class="n">volume</span> <span class="o">&lt;=</span> <span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Volume</span><span class="p">)</span>
<a name="ln-876"></a>        <span class="n">velocity</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span><span class="n">setting</span><span class="p">%</span><span class="n">Zerovalue</span><span class="p">%</span><span class="n">Velocity</span><span class="p">,</span> <span class="n">velocity</span><span class="p">)</span>
<a name="ln-877"></a>        <span class="n">elemYN</span><span class="p">(:,</span><span class="n">eYN_IsAdhocFlowrate</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-878"></a>    <span class="n">endwhere</span>
<a name="ln-879"></a> <span class="n">endif</span>
<a name="ln-880"></a> 
<a name="ln-881"></a> <span class="k">if</span> <span class="p">((</span><span class="n">debuglevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">debuglevelall</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;*** leave &#39;</span><span class="p">,</span><span class="n">subroutine_name</span>
<a name="ln-882"></a> <span class="k">end subroutine </span><span class="n">zero_velocity_at_zero_volume</span>
<a name="ln-883"></a><span class="c">!</span>
<a name="ln-884"></a><span class="c">!========================================================================== </span>
<a name="ln-885"></a><span class="c">! END OF MODULE adjustments</span>
<a name="ln-886"></a><span class="c">!========================================================================== </span>
<a name="ln-887"></a> <span class="k">end module </span><span class="n">adjustments</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SWMMengine was developed by Ben R. Hodges and Ehsan Madadi-Kandjani</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>